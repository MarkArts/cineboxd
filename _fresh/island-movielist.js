import"./chunk-PAN7BUOI.js";import{b as S}from"./chunk-TSNYIFOA.js";import"./chunk-D4CPDDRE.js";import{a as _}from"./chunk-4LGDFSDB.js";import{a as t}from"./chunk-RPWRD7AT.js";import{a as d,b as x,c as R}from"./chunk-4CGUAWBV.js";import"./chunk-ATX7TDFZ.js";var N=["Rewinding the tapes...","Buttering the popcorn...","Finding the best seats...","Checking what's playing...","Rolling the film reels...","Dimming the lights...","Shushing the audience...","Dodging spoilers...","Consulting the critics...","Scanning the marquee...","Adjusting the projector...","Queueing the trailers..."];function V(){return t("div",{style:{width:"80px",height:"80px",position:"relative",margin:"0 auto"},children:t("div",{class:"film-reel-spin",style:{width:"80px",height:"80px",borderRadius:"50%",border:"4px solid #3b82f6",position:"absolute",boxSizing:"border-box"},children:[[0,45,90,135,180,225,270,315].map(c=>t("div",{style:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"50%",top:"50%",left:"50%",transform:`rotate(${c}deg) translateY(-30px) translateX(-6px)`}},c)),t("div",{style:{position:"absolute",width:"20px",height:"20px",backgroundColor:"#0f1419",border:"3px solid #3b82f6",borderRadius:"50%",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]})})}function X(c){let p=c.split("/");return p.length>=2&&p[1]==="watchlist"?`@${p[0]}'s watchlist`:p.length>=3&&p[1]==="list"?`@${p[0]}/${p.slice(2).join("/")}`:c}function J({listPath:c}){let[p,B]=d([]),[y,$]=d(!1),[w,W]=d(null),[G,P]=d(0),[f,m]=d(""),[u,b]=d(""),[r,H]=d([]),[l,M]=d([]),[g,O]=d([]),[k,C]=d(!1),[T,D]=d(!1),[z,I]=d(!1);x(()=>{if(!y)return;let e=setInterval(()=>{P(i=>(i+1)%N.length)},2e3);return()=>clearInterval(e)},[y]),x(()=>{if(!S)return;let e=new URLSearchParams(globalThis.location.search),i=e.get("startDate"),o=e.get("endDate"),n=e.get("theaters")?.split(",").filter(Boolean),a=e.get("films")?.split(",").filter(Boolean),h=e.get("cities")?.split(",").filter(Boolean);i&&m(i),o&&b(o),n&&n.length>0&&M(n),a&&a.length>0&&O(a),h&&h.length>0&&H(h)},[]),x(()=>{if(!S)return;let e=i=>{i.target.closest("[data-dropdown]")||(C(!1),D(!1),I(!1))};if(k||T||z)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[k,T,z]),x(()=>{if(!S)return;let e=new URLSearchParams;f&&e.set("startDate",f),u&&e.set("endDate",u),r.length>0&&e.set("cities",r.join(",")),l.length>0&&e.set("theaters",l.join(",")),g.length>0&&e.set("films",g.join(","));let i=e.toString(),o=i?`${globalThis.location.pathname}?${i}`:globalThis.location.pathname;try{globalThis.history.replaceState({path:o},"",o)}catch{}},[f,u,r,l,g]);let q=async()=>{if(c.trim()){$(!0),W(null);try{let e=await fetch(`/api/cineboxd?listPath=${encodeURIComponent(c.trim())}`),i=await e.json();if(!e.ok)throw new Error(i?.error||`Failed to load list (HTTP ${e.status})`);B(i?.data?.showtimes?.data||[])}catch(e){W(e instanceof Error?e.message:"An error occurred"),B([])}finally{$(!1)}}};x(()=>{S&&q()},[c]);let{uniqueCities:K,uniqueTheaters:j,uniqueFilms:Q,filteredTheaters:U}=R(()=>{let e=new Map,i=new Map;p.forEach(s=>{s.theater&&!e.has(s.theater.name)&&e.set(s.theater.name,s.theater),s.film&&!i.has(s.film.slug)&&i.set(s.film.slug,s.film)});let o=Array.from(e.values()).sort((s,L)=>s.name.localeCompare(L.name)),n=Array.from(i.values()).sort((s,L)=>s.title.localeCompare(L.title)),a=new Set;o.forEach(s=>{s.address?.city&&a.add(s.address.city)});let h=Array.from(a).sort(),v=r.length>0?o.filter(s=>r.includes(s.address?.city||"")):o;return{uniqueCities:h,uniqueTheaters:o,uniqueFilms:n,filteredTheaters:v}},[p,r]);x(()=>{if(r.length>0&&l.length>0){let e=l.filter(i=>{let o=j.find(n=>n.name===i);return o&&r.includes(o.address?.city||"")});e.length!==l.length&&M(e)}},[r,l,j]);let Y=R(()=>{let e=p;return f&&(e=e.filter(i=>i.startDate.split("T")[0]>=f)),u&&(e=e.filter(i=>i.startDate.split("T")[0]<=u)),l.length>0&&(e=e.filter(i=>l.includes(i.theater.name))),g.length>0&&(e=e.filter(i=>g.includes(i.film.slug))),r.length>0&&(e=e.filter(i=>r.includes(i.theater.address?.city||""))),e},[p,f,u,l,g,r]),A=R(()=>{let e={},i=o=>o.toLowerCase().trim();return Y.forEach(o=>{let n=i(o.film.title);e[n]||(e[n]={film:o.film,shows:[],showsByDateAndTheater:new Map});let a=e[n].film;(!a.poster?.url&&o.film.poster?.url||!a.directors?.length&&o.film.directors?.length||!a.duration&&o.film.duration)&&(e[n].film={...a,poster:o.film.poster?.url?o.film.poster:a.poster,directors:o.film.directors?.length?o.film.directors:a.directors,duration:o.film.duration||a.duration}),e[n].shows.push(o);let h=o.startDate.split("T")[0],v=`${h}_${o.theater.name}`;e[n].showsByDateAndTheater.has(v)||e[n].showsByDateAndTheater.set(v,{date:h,theater:o.theater,shows:[]}),e[n].showsByDateAndTheater.get(v).shows.push(o)}),Object.values(e).sort((o,n)=>o.film.title.localeCompare(n.film.title))},[Y]),E=e=>i=>{e(o=>o.includes(i)?o.filter(n=>n!==i):[...o,i])},F=e=>{let i=new Date,o=i.toISOString().split("T")[0];if(e==="today")m(o),b(o);else if(e==="week"){let n=new Date(i);n.setDate(i.getDate()+(7-i.getDay())),m(o),b(n.toISOString().split("T")[0])}else{let n=new Date(i.getFullYear(),i.getMonth()+1,0);m(o),b(n.toISOString().split("T")[0])}};return t("div",{style:{minHeight:"100vh"},children:[t("header",{style:{backgroundColor:"#1e293b",borderBottom:"1px solid #2f3336",position:"sticky",top:0,zIndex:100},children:t("div",{class:"header-controls",style:{display:"flex",alignItems:"center",padding:"12px 16px",gap:"12px",flexWrap:"wrap"},children:[t("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t("a",{href:"/",style:{margin:0,fontSize:"20px",fontWeight:"bold",color:"#3b82f6",textDecoration:"none"},children:"Cineboxd"}),t("span",{style:{color:"#71767b",fontSize:"14px"},children:"\xB7"}),t("span",{style:{color:"#e1e8ed",fontSize:"14px"},children:X(c)})]}),t("div",{class:"header-row",style:{flex:1,display:"flex",gap:"8px",alignItems:"center",flexWrap:"wrap"},children:[t("div",{style:{display:"flex",gap:"4px"},children:[t("button",{type:"button",onClick:()=>F("today"),style:{padding:"6px 10px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:"#0f1419",color:"#e1e8ed",fontSize:"13px",cursor:"pointer"},children:"Today"}),t("button",{type:"button",onClick:()=>F("week"),style:{padding:"6px 10px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:"#0f1419",color:"#e1e8ed",fontSize:"13px",cursor:"pointer"},children:"This Week"}),t("button",{type:"button",onClick:()=>F("month"),style:{padding:"6px 10px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:"#0f1419",color:"#e1e8ed",fontSize:"13px",cursor:"pointer"},children:"This Month"})]}),t("div",{class:"date-filters",style:{display:"flex",alignItems:"center",gap:"4px"},children:[t("span",{style:{fontSize:"12px",color:"#71767b"},children:"From:"}),t("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[t("input",{class:"date-input",type:"date",value:f,onInput:e=>m(e.target.value),style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:"#0f1419",color:"#e1e8ed",fontSize:"14px",cursor:"pointer",minWidth:"140px",width:"140px"}}),f&&t("button",{type:"button",onClick:()=>m(""),style:{background:"#1e293b",border:"1px solid #2f3336",borderRadius:"3px",color:"#71767b",cursor:"pointer",padding:"4px 8px",fontSize:"14px",lineHeight:"1",height:"28px"},children:"x"})]}),t("span",{style:{fontSize:"12px",color:"#71767b"},children:"To:"}),t("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[t("input",{class:"date-input",type:"date",value:u,onInput:e=>b(e.target.value),style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:"#0f1419",color:"#e1e8ed",fontSize:"14px",cursor:"pointer",minWidth:"140px",width:"140px"}}),u&&t("button",{type:"button",onClick:()=>b(""),style:{background:"#1e293b",border:"1px solid #2f3336",borderRadius:"3px",color:"#71767b",cursor:"pointer",padding:"4px 8px",fontSize:"14px",lineHeight:"1",height:"28px"},children:"x"})]})]}),t("div",{style:{position:"relative"},"data-dropdown":"city",children:[t("button",{type:"button",onClick:()=>{C(!k),D(!1),I(!1)},style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:r.length>0?"#3b82f6":"#0f1419",color:r.length>0?"white":"#e1e8ed",fontSize:"14px",cursor:"pointer"},children:["All Cities"," ",r.length>0&&`(${r.length})`]}),k&&t("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",backgroundColor:"#1e293b",border:"1px solid #2f3336",borderRadius:"4px",padding:"8px",minWidth:"200px",maxHeight:"300px",overflowY:"auto",zIndex:1e3},children:K.map(e=>t("label",{style:{display:"flex",alignItems:"center",padding:"4px",cursor:"pointer",fontSize:"14px"},children:[t("input",{type:"checkbox",checked:r.includes(e),onChange:()=>E(H)(e),style:{marginRight:"8px"}}),e]},e))})]}),t("div",{style:{position:"relative"},"data-dropdown":"theater",children:[t("button",{type:"button",onClick:()=>{I(!z),C(!1),D(!1)},style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:l.length>0?"#3b82f6":"#0f1419",color:l.length>0?"white":"#e1e8ed",fontSize:"14px",cursor:"pointer"},children:["All Theaters ",l.length>0?`(${l.length})`:r.length>0?`(${U.length} available)`:""]}),z&&t("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",backgroundColor:"#1e293b",border:"1px solid #2f3336",borderRadius:"4px",padding:"8px",minWidth:"250px",maxHeight:"300px",overflowY:"auto",zIndex:1e3},children:U.map(e=>t("label",{style:{display:"flex",alignItems:"center",padding:"4px",cursor:"pointer",fontSize:"14px"},children:[t("input",{type:"checkbox",checked:l.includes(e.name),onChange:()=>E(M)(e.name),style:{marginRight:"8px"}}),e.name," ",e.address?.city&&`(${e.address.city})`]},e.name))})]}),t("div",{style:{position:"relative"},"data-dropdown":"movie",children:[t("button",{type:"button",onClick:()=>{D(!T),C(!1),I(!1)},style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid #2f3336",backgroundColor:g.length>0?"#3b82f6":"#0f1419",color:g.length>0?"white":"#e1e8ed",fontSize:"14px",cursor:"pointer"},children:["All Movies"," ",g.length>0&&`(${g.length})`]}),T&&t("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",backgroundColor:"#1e293b",border:"1px solid #2f3336",borderRadius:"4px",padding:"8px",minWidth:"250px",maxHeight:"300px",overflowY:"auto",zIndex:1e3},children:Q.map(e=>t("label",{style:{display:"flex",alignItems:"center",padding:"4px",cursor:"pointer",fontSize:"14px"},children:[t("input",{type:"checkbox",checked:g.includes(e.slug),onChange:()=>E(O)(e.slug),style:{marginRight:"8px"}}),e.title]},e.slug))})]})]})]})}),t("main",{style:{maxWidth:"1200px",margin:"0 auto",padding:"20px"},children:[y&&t("div",{style:{textAlign:"center",padding:"80px 40px",color:"#71767b"},children:[t(V,{}),t("p",{style:{marginTop:"24px",fontSize:"1.1rem",color:"#9ca3af",minHeight:"1.5em"},children:N[G]})]}),w&&t("div",{style:{textAlign:"center",padding:"60px 40px"},children:[t("div",{style:{fontSize:"3rem",marginBottom:"16px"},children:"\u{1F615}"}),t("p",{style:{color:"#f4212e",fontSize:"1.1rem",marginBottom:"24px"},children:w}),t("button",{type:"button",onClick:()=>q(),style:{padding:"12px 24px",fontSize:"14px",fontWeight:"600",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Try Again"})]}),!y&&!w&&A.length===0&&t("div",{style:{textAlign:"center",padding:"60px 40px"},children:[t("div",{style:{fontSize:"3rem",marginBottom:"16px"},children:"\u{1F3AC}"}),t("p",{style:{color:"#9ca3af",fontSize:"1.1rem",marginBottom:"16px"},children:"No showtimes found for this list"}),t("a",{href:`https://letterboxd.com/${c}/`,target:"_blank",rel:"noopener noreferrer",style:{color:"#3b82f6",textDecoration:"none",fontSize:"0.95rem"},children:"View list on Letterboxd \u2192"})]}),!y&&!w&&A.length>0&&t("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:A.map(({film:e,showsByDateAndTheater:i})=>t(_,{film:e,showsByDateAndTheater:Array.from(i.entries())},e.slug))}),t("footer",{style:{marginTop:"48px",paddingTop:"24px",borderTop:"1px solid #2f3336",textAlign:"center"},children:t("a",{href:"/105424/watchlist/",style:{color:"#71767b",textDecoration:"none",fontSize:"0.85rem"},children:"Check out the creator's watchlist \u2192"})})]})]})}export{J as default};
